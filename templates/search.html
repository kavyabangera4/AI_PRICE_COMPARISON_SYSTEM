<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Price Comparison - Search</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            900: '#0f172a', 
                            800: '#1e293b', 
                            700: '#334155', 
                        },
                        brand: {
                            teal: '#2dd4bf', 
                            blue: '#3b82f6', 
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { overflow-x: hidden; }
        .glass-nav {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
        }
        .hero-gradient {
            background: radial-gradient(circle at center, rgba(45, 212, 191, 0.15) 0%, rgba(15, 23, 42, 1) 70%);
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .hidden-section { display: none !important; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 10px 0; }
        .product-box { background-color: #1e293b; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); padding: 15px; color: white; display: flex; flex-direction: column; justify-content: space-between; height: 100%; transition: transform 0.2s; }
        .product-box:hover { transform: translateY(-4px); border: 1px solid #2dd4bf; }
        .product-box .product-image { width: 100%; height: 180px; object-fit: contain; margin-bottom: 15px; border-radius: 8px; background-color: #0f172a; padding: 10px; }
        .product-details { text-align: left; margin-bottom: 10px; }
        .product-name { font-size: 1.1em; font-weight: 600; line-height: 1.3; margin-bottom: 5px; color: #fff; }
        .product-price { font-size: 1.6em; color: #2dd4bf; font-weight: bold; margin: 10px 0 15px 0; }
        .btn-view-deal { display: block; text-align: center; padding: 10px; background-color: #2dd4bf; color: #0f172a; font-weight: bold; border-radius: 8px; transition: background-color 0.2s; }
        .btn-view-deal:hover { background-color: #6ee7f9; }
        .btn-set-alert { display: inline-block; text-align: center; padding: 8px 12px; background-color: #f97316; color: #0f172a; font-weight: 700; border-radius: 8px; transition: background-color 0.15s; }
        .btn-set-alert:hover { background-color: #fb923c; }
        .product-image-container { position: relative; overflow: hidden; }
        .product-image-container img { width: 100%; display: block; }
        .wishlist-btn { position: absolute; top: 10px; right: 10px; border: none; width: 40px; height: 40px; font-size: 30px; cursor: pointer; color: #6d6464; transition: color 0.2s; z-index: 10; }
        .wishlist-btn.tracked { color: red; font-weight: bold; text-shadow: 0 0 8px rgba(255, 0, 0, 0.8); filter: drop-shadow(0 0 3px rgba(255, 0, 0, 0.6)); }
        .wishlist-btn:hover:not(.tracked) { color: #726767; }
    </style>
</head>
<body class="bg-dark-900 text-slate-300 font-sans antialiased">

    Keep landing hidden for the Search page 
    <div id="landing-page" class="hidden-section">
         minimal landing content if needed 
        <nav class="fixed top-0 w-full z-50 glass-nav border-b border-dark-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-brand-teal to-brand-blue flex items-center justify-center text-white font-bold">
                            <i class="ph ph-robot"></i>
                        </div>
                        <span class="text-white font-bold text-xl tracking-tight">Price<span class="text-brand-teal">AI</span></span>
                    </div>
                </div>
            </div>
        </nav>
    </div>

   Show dashboard/search view by default on this page 
    <div id="dashboard-view" class="flex h-screen overflow-hidden bg-dark-900">
         Sidebar and main content copied from original index.html 
            <div class="mb-8 text-brand-teal text-2xl"><i class="ph ph-robot"></i></div>
            <nav class="flex-1 space-y-6">
                <a href="#" class="p-3 rounded-xl bg-dark-700 text-brand-teal shadow-lg shadow-teal-500/10 transition"><i class="ph ph-squares-four text-xl"></i></a>
                <a href="#" class="p-3 rounded-xl text-slate-400 hover:text-white hover:bg-dark-700 transition"><i class="ph ph-chart-line-up text-xl"></i></a>
                <a href="/wishlist" class="p-3 rounded-xl text-slate-400 hover:text-white hover:bg-dark-700 transition"><i class="ph ph-heart text-xl"></i></a>
            </nav>
            <button onclick="logout()" class="mb-4 p-3 rounded-xl text-red-400 hover:bg-red-500/10 transition" title="Logout">
                <i class="ph ph-sign-out text-xl"></i>
            </button>
        </aside>

        <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
            <div class="absolute top-0 left-0 w-full h-64 bg-gradient-to-b from-brand-teal/5 to-transparent pointer-events-none"></div>

            <header class="h-16 border-b border-dark-700 flex items-center justify-between px-8 bg-dark-900/90 backdrop-blur z-10">
                <h1 class="text-lg font-bold text-white">Dashboard</h1>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden sm:block">
                        <span id="user-display-name" class="block text-sm font-bold text-white">Demo User</span>
                    </div>
                    <img id="user-avatar" src="https://ui-avatars.com/api/?name=User&background=2dd4bf&color=0f172a" class="w-10 h-10 rounded-full border-2 border-dark-700">
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-8">
                <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-white">Price Tracker</h2>
                        <p class="text-slate-400 text-sm">Track products and get notified on price drops.</p>
                    </div>
                    <div class="flex gap-2 w-full md:w-[500px]">
                        <div class="relative flex-1">
                            <input type="text" id="product-search-input" class="w-full bg-dark-800 border border-dark-700 rounded-lg py-2.5 pl-4 pr-10 text-white focus:border-brand-teal focus:outline-none placeholder-slate-500" placeholder="Paste product link or name...">
                            <button onclick="searchProduct()" class="absolute right-1 top-1 bg-brand-teal p-1.5 rounded text-dark-900 hover:bg-teal-300 transition">
                                <i class="ph ph-magnifying-glass font-bold"></i>
                            </button>
                        </div>
                        <input type="file" id="image-upload-input" class="hidden" accept="image/*" onchange="uploadImage()">
                        <button onclick="document.getElementById('image-upload-input').click()" class="bg-dark-800 border border-dark-700 p-2.5 rounded-lg text-slate-300 hover:text-white hover:border-brand-teal transition" title="Search by Image">
                            <i class="ph ph-camera text-xl"></i>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-dark-800 p-5 rounded-xl border border-dark-700 shadow-lg">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-slate-400 text-xs uppercase">Tracking</p>
                                <h3 class="text-2xl font-bold text-white">45 Items</h3>
                            </div>
                            <div class="text-brand-teal text-3xl"><i class="ph ph-tag"></i></div>
                        </div>
                    </div>
                    <div class="bg-dark-800 p-5 rounded-xl border border-dark-700 shadow-lg">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-slate-400 text-xs uppercase">Alerts</p>
                                <h3 class="text-2xl font-bold text-white">3 Active</h3>
                            </div>
                            <div class="text-blue-500 text-3xl"><i class="ph ph-bell"></i></div>
                        </div>
                    </div>
                    <div id="filter-card" onclick="openFilterModal()" class="bg-dark-800 p-5 rounded-xl border border-dark-700 shadow-lg cursor-pointer hover:border-brand-teal transition">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-slate-400 text-xs uppercase">Filters</p>
                                <h3 class="text-2xl font-bold text-white">Filter results</h3>
                            </div>
                            <div class="text-teal-300 text-3xl"><i class="ph ph-funnel"></i></div>
                        </div>
                    </div>
                </div>

                <h3 class="text-white font-semibold mt-10 mb-4 text-xl">Search Results</h3>
                <div id="searchResultsContainer" class="product-grid">
                    <p class="text-center text-slate-500 col-span-full">Use the search bar above to find product comparisons.</p>
                </div>
            </div>
        </main>
    </div>

    Filter and alert modals (copied) 
    <div id="filter-modal" class="fixed inset-0 z-[65] hidden flex items-center justify-center bg-black/70 backdrop-blur-sm">
        <div class="bg-dark-800 p-6 rounded-2xl border border-dark-700 w-full max-w-lg relative">
            <button onclick="closeFilterModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <i class="ph ph-x text-2xl"></i>
            </button>
            <h3 class="text-white text-xl font-bold mb-4">Filter Results</h3>
            <div class="space-y-4">
                <label class="block text-sm text-slate-400">Filter By</label>
                <select id="filter-type" onchange="onFilterTypeChange()" class="w-full bg-dark-900 border border-dark-700 rounded-lg p-2 text-white">
                    <option value="price">Price</option>
                    <option value="brand">Brand</option>
                </select>

                <div id="price-filters" class="space-y-2 mt-2">
                    <label class="text-sm text-slate-400">Sort</label>
                    <div class="flex items-center gap-3">
                        <label class="inline-flex items-center gap-2"><input id="sort-increasing" type="checkbox" class="rounded"> Sort by increasing price</label>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <input id="min-price" type="number" placeholder="Min price" class="bg-dark-900 border border-dark-700 rounded-lg p-2 text-white">
                        <input id="max-price" type="number" placeholder="Max price" class="bg-dark-900 border border-dark-700 rounded-lg p-2 text-white">
                    </div>
                </div>

                <div id="brand-filters" class="hidden mt-2">
                    <label class="text-sm text-slate-400">Select Brand</label>
                    <select id="brand-select" class="w-full bg-dark-900 border border-dark-700 rounded-lg p-2 text-white">
                        <option value="">(Select a brand)</option>
                    </select>
                </div>

                <div class="flex justify-end gap-2 mt-4">
                    <button onclick="applyFilter()" class="bg-brand-teal text-dark-900 px-4 py-2 rounded-lg font-bold">Apply</button>
                    <button onclick="closeFilterModal()" class="bg-dark-700 text-slate-300 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="alert-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-black/70 backdrop-blur-sm">
        <div class="bg-dark-800 p-6 rounded-2xl border border-dark-700 w-full max-w-md relative">
            <button onclick="closeAlertModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <i class="ph ph-x text-2xl"></i>
            </button>
            <h3 class="text-white text-xl font-bold mb-4">Set Price Alert</h3>
            <div class="space-y-3">
                <p class="text-slate-400 text-sm" id="alert-product-name"></p>
                <label class="block text-sm text-slate-400">Target Price (numeric)</label>
                <input id="alert-target-price" type="number" step="0.01" class="w-full bg-dark-900 border border-dark-700 rounded-lg p-2 text-white" placeholder="e.g. 299.00">
                <div class="flex justify-end gap-2 mt-4">
                    <button onclick="createAlert()" class="bg-brand-teal text-dark-900 px-4 py-2 rounded-lg font-bold">Set Alert</button>
                    <button onclick="closeAlertModal()" class="bg-dark-700 text-slate-300 px-4 py-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    const API_BASE_URL = 'http://127.0.0.1:5000/api';
    const productGridContainer = document.getElementById('searchResultsContainer'); 
    window.lastSearchResults = window.lastSearchResults || [];

    function openFilterModal() {
        if (!window.lastSearchResults || window.lastSearchResults.length === 0) {
            alert('No products loaded. Perform a search first to populate filter options.');
            return;
        }
        document.getElementById('filter-modal').classList.remove('hidden');
        onFilterTypeChange();
        populateBrandDropdown();
    }
    function closeFilterModal() { document.getElementById('filter-modal').classList.add('hidden'); }
    function onFilterTypeChange() { const t = document.getElementById('filter-type').value; document.getElementById('price-filters').classList.toggle('hidden', t !== 'price'); document.getElementById('brand-filters').classList.toggle('hidden', t !== 'brand'); }
    function populateBrandDropdown() { const sel = document.getElementById('brand-select'); if (!sel) return; sel.innerHTML = '<option value="">(Select a brand)</option>'; const brands = Array.from(new Set((window.lastSearchResults || []).map(p => p.brand).filter(Boolean))).sort(); brands.forEach(b => { const opt = document.createElement('option'); opt.value = b; opt.textContent = b; sel.appendChild(opt); }); }
    function parsePriceString(s) { if (s === undefined || s === null) return 0; const n = parseFloat(String(s).replace(/[^0-9.]/g, '')); return isNaN(n) ? 0 : n; }
    function applyFilter() { if (!window.lastSearchResults || window.lastSearchResults.length === 0) { alert('No products to filter.'); return; } const type = document.getElementById('filter-type').value; let filtered = window.lastSearchResults.slice(); if (type === 'price') { const min = parseFloat(document.getElementById('min-price').value) || 0; const maxRaw = document.getElementById('max-price').value; const max = maxRaw ? parseFloat(maxRaw) : Number.POSITIVE_INFINITY; filtered = filtered.filter(p => { const price = parsePriceString(p.price); return price >= min && price <= max; }); const sortIncreasing = document.getElementById('sort-increasing').checked; if (sortIncreasing) filtered.sort((a, b) => parsePriceString(a.price) - parsePriceString(b.price)); } else if (type === 'brand') { const brand = document.getElementById('brand-select').value; if (brand) filtered = filtered.filter(p => String(p.brand) === brand); } renderProductGrid(filtered); closeFilterModal(); }
    function openAlertModal(buttonOrElem) { 
        let product; 
        if (typeof buttonOrElem === 'string') { 
            try { product = JSON.parse(decodeURIComponent(buttonOrElem)); } 
            catch(e){ 
                try { product = JSON.parse(buttonOrElem); } 
                catch(err){ product = null; } 
            } 
        } else if (buttonOrElem && buttonOrElem.getAttribute) { 
            // Try new method: data-product-index
            const productIndex = buttonOrElem.getAttribute('data-product-index');
            if (productIndex && window.productDataStore && window.productDataStore[productIndex]) {
                product = window.productDataStore[productIndex];
            } else {
                // Fallback: try old method with data-product attribute
                try { 
                    const encodedData = buttonOrElem.getAttribute('data-product');
                    if (encodedData) {
                        product = JSON.parse(decodeURIComponent(encodedData)); 
                    }
                } catch(e){ 
                    try {
                        const rawData = buttonOrElem.getAttribute('data-product');
                        if (rawData) {
                            product = JSON.parse(rawData);
                        }
                    } catch(err) {
                        product = null; 
                    }
                } 
            }
        } 
        if (!product) { alert('Product data missing for alert.'); return; } 
        window._pendingAlertProduct = product; 
        document.getElementById('alert-product-name').innerText = product.product_name || product.product_name; 
        const current = parseFloat(String(product.price).replace(/[^0-9.]/g, '')) || ''; 
        document.getElementById('alert-target-price').value = current; 
        document.getElementById('alert-modal').classList.remove('hidden'); 
    }
    function closeAlertModal(){ document.getElementById('alert-modal').classList.add('hidden'); window._pendingAlertProduct = null; }
    async function createAlert(){ const input = document.getElementById('alert-target-price'); const val = input.value; if (!val) { alert('Please enter a numeric target price.'); return; } const product = window._pendingAlertProduct; if (!product) { alert('No product selected.'); return; } try { const resp = await fetch('/api/alerts/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ product: product, target_price: val }) }); const j = await resp.json(); if (j.success) { alert('Alert created successfully. You will be notified when price drops.'); closeAlertModal(); } else { alert('Could not create alert: ' + (j.message || 'server error')); } } catch (e) { console.error('Error creating alert', e); alert('Network error creating alert.'); } }
    function logout() { window.location.href = '/'; }
    // Store products in a global object to avoid HTML attribute length limits
    window.productDataStore = window.productDataStore || {};
    let productIndexCounter = 0;
    
    function renderProductGrid(products) {
        productGridContainer.innerHTML = '';
        productIndexCounter = 0; // Reset counter for new search
        window.productDataStore = {}; // Clear previous data
        
        if (products.length === 0) { productGridContainer.innerHTML = `<p class="text-center text-slate-500 col-span-full">No matching products found. Try a different query.</p>`; return; }
        products.forEach(p => {
            // Store product data in global object to avoid HTML attribute issues with long URLs
            const productIndex = `prod_${productIndexCounter++}`;
            window.productDataStore[productIndex] = p;
            let sourceLogo = '';
            try { if (p.source_logo) { sourceLogo = p.source_logo; } else if (p.url) { sourceLogo = `https://www.google.com/s2/favicons?domain=${(new URL(p.url)).hostname}&sz=64`; } else { sourceLogo = 'https://via.placeholder.com/32/1e293b/FFFFFF?text=?'; } } catch (e) { sourceLogo = 'https://via.placeholder.com/32/1e293b/FFFFFF?text=?'; }
            const box = document.createElement('div'); box.className = 'product-box'; box.innerHTML = `
            <div class="product-image-container">
                <img src="${p.image_src}" alt="${p.product_name}" class="product-image" onerror="this.onerror=null;this.src='https://via.placeholder.com/300x180/1e293b/FFFFFF?text=No+Image';">
                <button class="wishlist-btn" title="Add to WishList" data-product-index="${productIndex}" onclick="addToWishlist(this)">
                    <i class="ph ph-heart"></i></button>
            </div>
            <div class="product-details flex-1">
                <h5 class="product-name" title="${p.product_name}">${p.product_name}</h5>
                <p class="text-xs text-slate-400 flex items-center gap-2"><img src="${sourceLogo}" alt="${p.source}" class="w-5 h-5 rounded object-contain"> <span>Source: <strong>${p.source}</strong></span></p>
                <p class="text-xs text-slate-400">Brand: <strong>${p.brand}</strong></p>
                <p class="text-xs text-slate-400">Rating: ${p.rating} | Similarity: ${p.similarity_score}</p>
            </div>
            <div class="product-footer mt-4 flex items-center justify-between gap-4">
                <p class="product-price">Price: ${p.price}</p>
                <div class="flex items-center gap-2">
                    <a href="${p.url}" target="_blank" rel="noopener noreferrer" class="btn-view-deal">View Product</a>
                    <button class="btn-set-alert" data-product-index="${productIndex}" onclick="openAlertModal(this)">Set Alert</button>
                </div>
            </div>
            `;
            productGridContainer.appendChild(box);
        });
    }
    async function performSearch(type, payload) {
        productGridContainer.innerHTML = `<p class="text-center text-brand-teal col-span-full py-10">Searching for deals...</p>`;
        let endpoint = 'search';
        let fetchOptions = { method: 'POST' };
        if (type === 'text') { fetchOptions.headers = { 'Content-Type': 'application/json' }; fetchOptions.body = JSON.stringify({ query: payload }); }
        else if (type === 'image') { const formData = new FormData(); formData.append('product_image', payload); fetchOptions.body = formData; }
        try { const response = await fetch(`${API_BASE_URL}/${endpoint}`, fetchOptions); const result = await response.json(); if (result.success) { window.lastSearchResults = result.results || []; populateBrandDropdown(); renderProductGrid(result.results); } else { alert(`Search Failed: ${result.message}`); productGridContainer.innerHTML = `<p class="text-center text-red-400 col-span-full py-10">Search Failed: ${result.message}</p>`; } } catch (error) { console.error('Search Network or Server Error:', error); alert("Could not connect to the search server. Check the Flask terminal for errors."); productGridContainer.innerHTML = `<p class="text-center text-red-400 col-span-full py-10">Server Connection Error. Check console.</p>`; } }
    function searchProduct() { const query = document.getElementById('product-search-input').value.trim(); if (query) { performSearch('text', query); } else { alert("Please enter a product name or link for text search."); } }
    function uploadImage() { const fileInput = document.getElementById('image-upload-input'); const file = fileInput.files[0]; if (file) { performSearch('image', file); } else { alert("Please select an image file to upload."); } }
    async function addToWishlist(buttonElement) {
        if (!sessionStorage.getItem('user_id') && !localStorage.getItem('userEmail')) { alert("Please log in to add items to your Price Tracker."); buttonElement.classList.remove('tracked'); return; }
        let productData; 
        try { 
            const productIndex = buttonElement.getAttribute('data-product-index');
            if (productIndex && window.productDataStore && window.productDataStore[productIndex]) {
                productData = window.productDataStore[productIndex];
            } else {
                // Fallback: try old method with data-product attribute
                const encodedData = buttonElement.getAttribute('data-product');
                if (encodedData) {
                    productData = JSON.parse(decodeURIComponent(encodedData));
                }
            }
            if (!productData || !productData.url) { alert("Error: Missing product data (URL) on the button."); return; } 
        } catch (e) { 
            try { 
                // Fallback: try parsing without decoding
                const rawData = buttonElement.getAttribute('data-product');
                if (rawData) {
                    productData = JSON.parse(rawData); 
                }
            } catch (err) { 
                console.error("Failed to parse product data JSON:", e, err); 
                alert("Internal error processing product information."); 
                return; 
            } 
        }
        buttonElement.disabled = true;
        try {
            const resp = await fetch('/api/wishlist/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ product: productData }) });
            const data = await resp.json(); if (data.success) { buttonElement.classList.add('tracked'); alert('Product added to your wishlist!'); } else { alert(`Error adding to wishlist: ${data.message}`); buttonElement.classList.remove('tracked'); }
        } catch (err) { console.error('Network error during wishlist add:', err); alert('Failed to connect to the server.'); buttonElement.classList.remove('tracked'); }
        finally { buttonElement.disabled = false; }
    }
    

        document.addEventListener('DOMContentLoaded', fetchWishlist);

        async function fetchWishlist() {
            const wishlistGrid = document.getElementById('wishlist-grid');
            
            try {
                const response = await fetch('/api/wishlist/view', { method: 'GET' });
                const data = await response.json();
                
                wishlistGrid.innerHTML = ''; 

                if (data.success) {
                    if (data.products.length === 0) {
                        wishlistGrid.innerHTML = '<p class="text-center text-slate-500 col-span-full">You have no items in your Price Tracker yet. Start searching and adding products!</p>';
                    } else {
                        renderWishlistProducts(data.products, wishlistGrid);
                    }
                } else {
                    wishlistGrid.innerHTML = `<p class="text-center text-red-400 col-span-full">${data.message} Please log in to view your tracker.</p>`;
                }

            } catch (error) {
                console.error('Fetch error:', error);
                wishlistGrid.innerHTML = '<p class="text-center text-red-500 col-span-full">Failed to connect to the server to fetch your wishlist.</p>';
            }
        }

        function renderWishlistProducts(products, container) {
            let htmlContent = '';
            products.forEach(product => {
                // IMPORTANT: Pass the product hash (URL) to the remove button
                const productHash = product.url ? product.url : product.name.replace(/\s/g, '-').toLowerCase();

                htmlContent += `
                    <div class="product-card-wishlist p-4 flex flex-col">
                        <div class="product-image-container-wishlist">
                            <img 
                                src="${product.image}" 
                                alt="${product.name}" 
                                class="product-image-item" 
                                onerror="this.onerror=null;this.src='default.jpg'"
                            >
                        </div>
                        
                        <div class="flex-grow flex flex-col pt-2">
                            <h5 class="text-lg font-semibold text-white mb-2 leading-tight">${product.name}</h5>
                            
                            <p class="text-3xl font-extrabold text-teal-400 mt-auto mb-3">${product.price}</p>
                            
                            <p class="text-xs text-slate-400">Added on: <strong>${product.date_added}</strong></p>
                            
                            <a href="#" class="btn-view-deal">
                                View History
                            </a>
                            

                            
                            <button class="btn-set-alert" onclick="removeFromWishlist('${encodeURIComponent(productHash)}')">
                                Remove from Tracker
                            </button>   
                        </div>
                    </div>      
                `;
            });
            container.innerHTML = htmlContent;
        }   
        async function removeFromWishlist(productHashEncoded) {
            const productHash = decodeURIComponent(productHashEncoded);
            try {
                const response = await fetch('/api/wishlist/remove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product_hash: productHash })
                });
                const data = await response.json();

                if (data.success) {
                    alert('Product removed from your wishlist.');
                    fetchWishlist(); // Refresh the wishlist display
                } else {
                    alert(`Error removing product: ${data.message}`);
                }
            } catch (error) {
                console.error('Error removing product from wishlist:', error);
                alert('Failed to connect to the server to remove the product.');
            }
        }
    </script>
</body> 
</html> -->